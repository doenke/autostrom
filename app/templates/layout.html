<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Autostrom Abrechnung</title>
    <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}" />
  </head>
  <body>
    <header>
      <span class="name">Autostrom</span>
      <h1>Abrechnung &amp; Versand</h1>
    </header>

    <main>
      {% block content %}{% endblock %}
    </main>

    <footer>
      Autostrom &ndash; Nextcloud CSV Abrechnung
    </footer>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const locale = navigator.language || 'de-DE';

        document.querySelectorAll('.delete-entry-form').forEach(function (form) {
          form.addEventListener('submit', function (event) {
            if (!confirm('Willst du wirklich den letzten Eintrag l√∂schen?')) {
              event.preventDefault();
            }
          });
        });

        const numberFormatterCache = {};
        const getFormatter = function (decimals, grouping) {
          const key = decimals + '|' + grouping;
          if (!numberFormatterCache[key]) {
            numberFormatterCache[key] = new Intl.NumberFormat(locale, {
              minimumFractionDigits: decimals,
              maximumFractionDigits: decimals,
              useGrouping: grouping,
            });
          }
          return numberFormatterCache[key];
        };

        document.querySelectorAll('[data-number]').forEach(function (el) {
          const rawValue = Number(el.getAttribute('data-number'));
          if (!Number.isFinite(rawValue)) {
            return;
          }
          const decimals = parseInt(el.getAttribute('data-decimals') || '0', 10);
          const grouping = (el.getAttribute('data-grouping') || 'true') !== 'false';
          const suffix = el.getAttribute('data-suffix');
          const formatter = getFormatter(decimals, grouping);
          const formatted = formatter.format(rawValue);
          el.textContent = suffix ? formatted + ' ' + suffix : formatted;
        });

        const dateInput = document.getElementById('ablesedatum');
        if (dateInput) {
          dateInput.setAttribute('lang', locale);
          if (dateInput.value) {
            const parsedDate = new Date(dateInput.value);
            if (!isNaN(parsedDate)) {
              dateInput.valueAsDate = parsedDate;
            }
          }
        }
      });
    </script>
  </body>
</html>
